<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Use Stylo - Sistema de Vendas</title>
  <style>
    :root {
      --branco: #F0F0F0;
      --preto: #000000;
      --background2: #121212;
      --cinza: #1a1a1a;
      --fundo1: #1E1E1E;
      --borda: #2C2C2C;
      --backgroud1: #21003d;
      --principal: #a200ff;
      --principal2: #9B59B6;
      --principal3: #BB6BD9;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(to bottom, var(--background2), var(--preto));
      color: var(--branco);
    }

    h1 {
      text-align: center;
      color: var(--branco);
    }

    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    nav button {
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      background: var(--cinza);
      color: var(--principal);
      border: 1px solid var(--borda);
    }

    nav button:hover {
      background-color: var(--principal);
      color: var(--branco);
      transition: all 0.3s ease;
    }

    section {
      display: none;
      background: var(--fundo1);
      padding: 20px;
      margin-top: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
    }

    section.active {
      display: block;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      overflow-x: auto;
      color: var(--branco);
    }

    table,
    th,
    td {
      border: 1px solid var(--borda);
    }

    th,
    td {
      padding: 8px;
      text-align: left;
    }

    input,
    select {
      padding: 7px;
      margin: 5px 0;
      width: 100%;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid var(--borda);
      background: var(--background2);
      color: var(--branco);
    }

    button {
      background: var(--preto);
      color: var(--principal);
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      padding: 5px 5px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    button:hover {
      background-color: var(--principal);
      color: var(--branco);
      transition: all 0.3s ease;
    }

    @media (max-width: 600px) {
      body {
        padding: 10px;
      }

      table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }

      nav button {
        flex: 1 1 100%;
      }
    }

    /*! ------------------------------- */
    /*! Informa√ß√µes para Footer         */
    /*! ------------------------------- */

    .footer {
      display: flex;
      justify-content: center;
      margin: 0 auto;
      width: 100%;
      height: 100%;
      background-color: var(--preto);
      color: var(--branco);
    }

    .footer .footer1 {
      display: flex;
      justify-content: space-evenly;
      width: 100%;
    }

    .footer .footer1 a {
      color: var(--principal);
      text-decoration: none;
    }

    .footer .footer1 a:hover {
      color: var(--backgroud1);
      text-decoration-line: underline;
      transition: all .50s ease;
    }

    .footer .footer1 span a {
      color: var(--principal);
    }

    /*! ------------------------------- */
    /*! Informa√ß√µes para Commits        */
    /*! ------------------------------- */

    .changelog-container {
      width: 80%;
      margin: 30px auto;
      background-color: var(--fundo1);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
      color: var(--branco);
    }

    .changelog-header {
      text-align: center;
      color: var(--principal);
    }

    .changelog-entry {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid var(--borda);
      border-radius: 6px;
      background-color: var(--background2);
    }

    .changelog-entry h3 {
      margin: 0;
      font-size: 1.2em;
      color: var(--principal);
    }

    .changelog-entry p {
      margin: 10px 0 0;
      font-size: 1em;
      color: var(--branco);
    }

    .changelog-entry .changelog-date {
      font-size: 0.9em;
      color: var(--principal3);
    }

    .changelog-entry .changelog-header {
      font-weight: bold;
    }

    .changelog-entry .update-list {
      margin-top: 10px;
      list-style: none;
      padding-left: 20px;
    }

    .changelog-entry .update-list li {
      margin: 5px 0;
      font-size: 1em;
      color: var(--branco);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .modal-content {
      background: #222;
      color: #fff;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    }

    .modal-content button {
      background: #a200ff;
      color: #fff;
      border: none;
      padding: 10px 25px;
      margin-top: 20px;
      border-radius: 5px;
      cursor: pointer;
    }

    .modal-content button:hover {
      background: #8b00d6;
    }
  </style>

  <!--P ICONE DA PAGINA -->
  <link rel="icon" href="use-styloo-ico.ico" type="image/x-icon">
  <!--P FIM ICONE DA PAGINA -->

  <!--P SCRIPT COMPROVANTE PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!--P FIM SCRIPT COMPROVANTE PDF -->

  <!--P SCRIPT FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-analytics.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCprBTe8SI2yzWrCbiDqPo_quY6gtepSZ0",
      authDomain: "vendas-loja-use-stylo.firebaseapp.com",
      databaseURL: "https://vendas-loja-use-stylo-default-rtdb.firebaseio.com",
      projectId: "vendas-loja-use-stylo",
      storageBucket: "vendas-loja-use-stylo.appspot.com",
      messagingSenderId: "752808111854",
      appId: "1:752808111854:web:319ce58624153fb5818dff",
      measurementId: "G-SD289DZZVK"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getDatabase(app);

    // Declare crediarios aqui
    let crediarios = [];

    // üü¢ Expondo no window
    window.firebaseApp = app;
    window.analytics = analytics;
    window.db = db;
    window.ref = ref;
    window.set = set;
    window.get = get;
    window.child = child;

    // Exportar para Firebase (estoque, vendas e credi√°rios)
    window.exportarParaFirebase = () => {
      const dados = {
        estoque,
        vendas,
        crediarios: JSON.parse(localStorage.getItem('crediarios')) || [],
        historicoCrediariosPagos: JSON.parse(localStorage.getItem('historicoCrediariosPagos')) || [],
        ultimaAtualizacao: new Date().toLocaleString('pt-BR')
      };

      window.set(window.ref(window.db, 'backup'), dados)
        .then(() => {
          alert("Backup salvo na nuvem com sucesso!");
          document.getElementById('ultimaDataBackup').textContent = `√öltimo backup: ${dados.ultimaAtualizacao}`;
        })
        .catch((erro) => console.error("Erro ao salvar no Firebase:", erro));
    };
 
    window.importarDoFirebase = () => {
  window.get(window.child(window.ref(window.db), 'backup'))
    .then(snapshot => {
      if (snapshot.exists()) {
        const dados = snapshot.val();

        estoque = dados.estoque || [];
        vendas = dados.vendas || [];
        crediarios = dados.crediarios || [];
        const historico = dados.historicoCrediariosPagos || [];

        localStorage.setItem('crediarios', JSON.stringify(crediarios));
        localStorage.setItem('historicoCrediariosPagos', JSON.stringify(historico));

        salvarDados?.();
        atualizarSelectProdutos?.();
        atualizarHistorico?.();
        carregarCrediarios();
        carregarHistorico?.();

        if (dados.ultimaAtualizacao) {
          document.getElementById('ultimaDataBackup').textContent = `√öltimo backup: ${dados.ultimaAtualizacao}`;
        }

        alert("Backup importado da nuvem com sucesso!");
      } else {
        alert("Nenhum backup encontrado na nuvem.");
      }
    })
    .catch((erro) => {
      console.error("Erro ao importar do Firebase:", erro);
      alert("Houve um erro ao tentar importar os dados.");
    });
};

    // Mostrar data do √∫ltimo backup ao carregar
    window.addEventListener('DOMContentLoaded', () => {
      get(child(ref(db), 'backup'))
        .then(snapshot => {
          if (snapshot.exists() && snapshot.val().ultimaAtualizacao) {
            document.getElementById('ultimaDataBackup').textContent = `√öltimo backup: ${snapshot.val().ultimaAtualizacao}`;
          }
        })
        .catch((erro) => {
          console.error("Erro ao carregar a data do √∫ltimo backup:", erro);
          alert("Houve um erro ao tentar carregar a data do √∫ltimo backup.");
        });
    });
  </script>
  <!--P FIM SCRIPT FIREBASE -->

  <!--P SCRIPT GRAFICOS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!--P FIM SCRIPT GRAFICOS -->
</head>

<body>

  <!--! AVISOS DO SISTEMA -->
  <div id="avisoModal" class="modal-overlay">
    <div class="modal-content">
      <h2>Bem-vindo ao Sistema de Controle Use Stylo!</h2>
      <p>Certifique-se de ter cuidado com o que est√° alterando ou adicionando, toda altera√ß√£o que for <strong
          style="color: var(--principal);">Exportada ou Importada</strong> para a nuvem ser√° permanente.</p>
      <br>
      <p>Para solu√ß√µes de problemas ou d√∫vidas, entre em contato de imediato com o <a style="color: var(--principal);"
          href="https://github.com/freitasfzw/"><strong>Administrador do Sistema</strong></a>.</p>
      <button onclick="fecharAviso()">Ok</button>
    </div>
  </div>
  <!--! FIM AVISOS DO SISTEMA-->

  <!--! TITULO PRINCIPAL -->
  <h1>Sistema de Controle Use Stylo</h1>
  <!--! FIM TITULO PRINCIPAL -->

  <!--! MENU -->
  <nav>
    <button onclick="mostrarAba('estoque')">Estoque</button>
    <button onclick="mostrarAba('vendas')">Registrar Venda</button>
    <button onclick="mostrarAba('crediario')">Crediario</button>
    <button onclick="mostrarAba('nuvem')">Nuvem de Dados</button>
    <button onclick="mostrarAba('historico')">Painel de Controle</button>
    <button><a style="color: var(--principal); text-decoration: none;" href="#atualiza√ßoes">Atualiza√ß√µes</a></button>
  </nav>
  <!--! FIM MENU -->

  <section id="crediario">
    <h2 style="justify-content: center; align-items: center; text-align: center">Credi√°rio</h2>

    <div id="formCrediario" style="margin: 20px 0;">
      <input type="text" id="nomeCliente" placeholder="Nome do Cliente" />
      <input type="text" id="cpfCliente" placeholder="CPF" />
      <input type="text" id="numCliente" placeholder="Telefone do Cliente (EX: +5555999999999)">
      <input type="text" id="produtosComprados" placeholder="Produtos Comprados" />
      <input type="text" id="valorCompra" placeholder="Valor da Compra" />
      <input type="date" id="dataCompra" />
      <input type="number" id="diaPagamento" placeholder="Dia do M√™s para Pagamento" min="1" max="31" />
      <input type="number" id="parcelasTotais" placeholder="N√∫mero de Parcelas" min="1" />
      <button id="btnSalvarCrediario">Salvar Credi√°rio</button>
    </div>

    <div id="listaCrediarios">
      <h3>Clientes no Credi√°rio</h3>
    </div>
    <br>
    <hr>
    <br>
    <div id="listaHistoricoCrediarios">
      <h2 style="justify-content: center; align-items: center; text-align: center"> Hist√≥rico de Credi√°rios</h2>
    </div>
  </section>

  <!--! MENU ESTOQUE -->
  <section id="estoque">
    <h2 style="justify-content: center; align-items: center; text-align: center;">Cadastro de Produto</h2>
    <input type="text" id="nomeProduto" placeholder="Nome do Produto">
    <input type="number" id="quantidadeProduto" placeholder="Quantidade">
    <input type="number" id="precoProduto" placeholder="Pre√ßo (R$)">
    <button onclick="adicionarProduto()">Adicionar ao Estoque</button>
    <h3 style="justify-content: center; align-items: center; text-align: center;">Estoque Atual</h3>
    <table id="tabelaEstoque"></table>


  </section>
  <!--! FIM MENU ESTOQUE -->

  <!--! MENU VENDAS -->
  <section id="vendas">
    <h2 style="justify-content: center; align-items: center; text-align: center;">Registrar Venda</h2>
    <select id="produtoVenda"></select>
    <input type="text" id="clienteVenda" placeholder="Nome do Cliente">
    <input type="number" id="quantidadeVenda" placeholder="Quantidade Vendida">
    <label for="descontoVenda">Desconto (%):</label>
    <input type="number" id="descontoVenda" min="0" max="100" placeholder="0">

    <div class="form-group">
      <label for="formaPagamento">Forma de Pagamento</label>
      <select id="formaPagamento" class="form-control" required>
        <option value="Dinheiro">Dinheiro</option>
        <option value="Cartao-Debito">Cart√£o - Debito</option>
        <option value="Cartao-Credito">Cart√£o - Cr√©dito</option>
        <option value="Pix">PIX</option>

      </select>
    </div>

    <button onclick="adicionarAoCarrinho()">Adicionar ao Carrinho</button>

    <h2 style="justify-content: center; align-items: center; text-align: center;">Carrinho</h2>
    <div id="carrinhoContainer"></div>
    <br>

    <button onclick="finalizarVenda()">Finalizar Venda</button>

    <div class="main-container">
      <h1>Calculadora de Troco</h1>
    </div>
    <div id="calculadora" class="container">
      <div class="header">
      </div>
      <br>

      <div class="input-group">
        <label>Valor da compra</label>
        <input type="number" id="valorCompra" placeholder="Ex: 23.50" />
      </div>

      <div class="input-group">
        <label>Valor pago</label>
        <input type="number" id="valorPago" placeholder="Ex: 50.00" />
      </div>

      <button onclick="calcularTroco()">Calcular Troco</button>

      <div id="resultado" class="resultado"></div>
    </div>

  </section>
  <!--! FIM MENU VENDAS -->


  <!--! MENU NUVEM -->
  <section id="nuvem">
    <h2 style="justify-content: center; align-items: center; text-align: center;">Nuvem de Dados</h2>

    <h3 style="color: var(--branco); font-size: 15px;">Toda a√ß√£o √© irreversivel pois n√£o existe backup no banco de
      dados!</h3>
    <button onclick="exportarParaFirebase()">Salvar Dados na Nuvem</button>
    <br><br>

    <button onclick="importarDoFirebase()">Carregar Dados Salvos da Nuvem</button>
    <p id="ultimaDataBackup" style="font-weight: bold; color: var(--branco);"></p>

  </section>
  <!--! FIM MENU NUVEM -->

  <!--! MENU HISTORICO -->
  <section id="historico">
    <h2 style="justify-content: center; align-items: center; text-align: center;">Hist√≥rico de Vendas</h2>
    <label>Filtrar por data:</label>
    <input type="date" id="filtroData">
    <button onclick="filtrarVendas()">Filtrar</button>
    <button onclick="removerFiltro()">Remover Filtro</button>


    <input type="file" id="arquivoBackup" style="display:none" onchange="carregarBackup(event)">
    <h3 style="justify-content: center; align-items: center; text-align: center;">Vendas Registradas</h3>
    <table id="tabelaVendas"></table>

    <div id="totaisPorForma"></div>
    <h3>Total Vendido: R$ <span id="totalVendido">0,00</span></h3>

    <p id="valorTotalEstoque" style="margin-top: 10px; font-weight: bold; font-size: 20px;">Valor Total em Estoque: R$
      0,00</p>

    <h3 style="justify-content: center; align-items: center; text-align: center;">Gr√°fico de Vendas</h3>
    <button onclick="atualizarGrafico('semana')">Semanal</button>
    <button onclick="atualizarGrafico('mes')">Mensal</button>
    <button onclick="atualizarGrafico('ano')">Anual</button>
    <canvas id="graficoVendas" height="100"></canvas>
    <canvas id="graficoSemanal" height="100"></canvas>
  </section>
  <!--! FIM MENU HISTORICO -->

  <!--! ATUALIZA√á√ïES DO SISTEMA -->
  <div class="changelog-container" id="atualiza√ßoes">
    <h1 class="changelog-header">Hist√≥rico de Atualiza√ß√µes</h1>

    <!-- Vers√£o Final 2.1.0 -->
    <div class="changelog-entry">
      <h3>Vers√£o Final 2.1.0 - Remo√ß√£o Sistema Login + Adi√ß√£o sistema de comprovante</h3>
      <p class="changelog-date">28 de Abril de 2025</p>
      <p class="changelog-header">Corre√ß√µes:</p>
      <ul class="update-list">
        <li>1. Remo√ß√£o sistema de login.</li>
      </ul>

      <p class="changelog-date">28 de Abril de 2025</p>
      <p class="changelog-header">Novidades:</p>
      <ul class="update-list">
        <li>1. Adicionado sistema de seguran√ßa sem necessidade de sistema de login.</li>
        <li>2. Adicionado sistema de gerar comprovante da compra.</li>
        <li>3. Adicionado sistema de impress√£o de comprovante automatico ao finalizar uma venda(requer Mini Impressora
          para imprimir o comprovante como se fosse maquina de cart√£o.)</li>
        <li>4. Adicionado sistema de informar nome da venda + Op√ß√£o de exibir hor√°rio que foi efetuada a venda.</li>
      </ul>

    </div>
    <!-- Vers√£o Final 2.0.0 -->
    <div class="changelog-entry">
      <h3>Vers√£o Final 2.0.0 - Corre√ß√£o de Bug + Novidades</h3>
      <p class="changelog-date">17 de Abril de 2025</p>
      <p class="changelog-header">Corre√ß√µes:</p>
      <ul class="update-list">
        <li>1. Corrigido ao filtrar por data, o sistema n√£o carregava os bot√µes de op√ß√£o sobre as vendas.<strong
            style="color: var(--principal);">(Painel de Controle)</strong></li>
        <li>2. Corrigida a l√≥gica de exibi√ß√£o formas de pagamento ao filtrar as vendas por data.<strong
            style="color: var(--principal);">(Painel de Controle)</strong></li>
        <li>3. Corrigido problema de exibi√ß√£o do gr√°fico, garantindo que ele seja exibido corretamente com os descontos
          aplicados na venda.<strong style="color: var(--principal);">(Painel de Controle)</strong></li>
        <li>4. Corrigido problema ao tentar realizar uma exporta√ß√£o de dados para a Nuvem sobre os Dados do
          Crediarios.<strong style="color: var(--principal);">(Nuvem)</strong></li>
      </ul>

      <p class="changelog-date">17 de Abril de 2025</p>
      <p class="changelog-header">Novidades:</p>
      <ul class="update-list">
        <li>1. Adicionada aba Crediario.<strong style="color: var(--principal);">(Crediario)</strong></li>
        <li>2. Adicionado sistema de registro de Dados do Crediario(√©s de extrema import√¢ncia ressaltar que, ao realizar
          uma venda na aba Registrar Venda com a forma de pagamento desejeada como: Crediario, √© necessario adicionar as
          informa√ß√µes extras do individuo atrav√©s da aba Crediarios), a onde ser√° possivel registrar dados pessoais do
          individuo e realizar o pagamento das faturas do mesmo.<strong
            style="color: var(--principal);">(Crediario)</strong></li>
        <li>3. Adicionada aba Nuvem.<strong style="color: var(--principal);">(Nuvem)</strong></li>
        <li>4. Adicionado sistema a onde os Dados do Crediario s√£o Salvos/Carregados da nuvem em perfeito estado.<strong
            style="color: var(--principal);">(Nuvem)</strong></li>
        <li>5. Adicionado sistema de CALCULADORA DE TROCO, a onde ser√° poss√≠vel agora, manualmente informar o valor da
          venda, o valor que foi recebido do comprador e receber o valor que deve ser devolvido ao mesmo.<strong
            style="color: var(--principal);">(Registrar Venda)</strong></li>
        <li>6. Adicionado aba Atualiza√ß√µes.<strong style="color: var(--principal);">(Atualiza√ßoes)</strong></li>
      </ul>
    </div>
    <!-- [BETA] Vers√£o 1.1.0 -->
    <div class="changelog-entry">
      <h3>[BETA] Vers√£o 1.1.0 - Corre√ß√£o de Bug + Adi√ß√£o de √ötilit√°rios</h3>
      <p class="changelog-date">14 de Abril de 2025</p>
      <p class="changelog-header">Corre√ß√µes:</p>
      <ul class="update-list">
        <li>1. Corrigido o erro de informa√ß√µes undefined no hist√≥rico de vendas ao registrar a forma de
          pagamento.<strong style="color: var(--principal);">(Painel de Controle)</strong></li>
        <li>2. Corrigida a l√≥gica de exibi√ß√£o de produtos pagos no hist√≥rico de vendas, garantindo a precis√£o das
          informa√ß√µes.<strong style="color: var(--principal);">(Painel de Controle)</strong></li>
        <li>3. Corrigido problema de exibi√ß√£o do gr√°fico, garantindo que ele seja exibido corretamente.<strong
            style="color: var(--principal);">(Painel de Controle)</strong></li>
        <li>4. Corrigido problema ao tentar realizar uma exporta√ß√£o de dados para a Nuvem.<strong
            style="color: var(--principal);">(Nuvem)</strong></li>
      </ul>

      <p class="changelog-date">14 de Abril de 2025</p>
      <p class="changelog-header">Novidades:</p>
      <ul class="update-list">
        <li>1. Adicionado estiliza√ß√£o de tons mais escuros de preto com detalhes em roxo para criar um tema dark, com
          ajustes nas cores de fundo, texto e bordas.<strong style="color: var(--principal);">(Sistema De Controle Use
            Stylo)</strong></li>

        <li>2. Adicionado na estrutura do menu e das se√ß√µes, com bot√µes maiores e mais espa√ßados para facilitar a
          navega√ß√£o. Ajustes nas tabelas de estoque e vendas para uma visualiza√ß√£o mais limpa.<strong
            style="color: var(--principal);">(Sistema de Controle Use Stylo)</strong></li>

        <li>3. Adicionado transi√ß√µes suaves nos bot√µes e links, com feedback visual ao passar o mouse. Implementa√ß√£o de
          responsividade para dispositivos m√≥veis, ajustando o layout automaticamente.<strong
            style="color: var(--principal);">(Sistema de Controle Use Stylo)</strong></li>

        <li>4. Adicionado Sistema de separa√ß√£o do valor total exibido no Registro de Venda, agora separado por Dinheiro,
          Pix, Cart√£o-D√©bito, Cart√£o-Cr√©dito, Crediario, Valor Total.<strong style="color: var(--principal);">(Painel de
            Controle)</strong></li>

        <li>5. Adicionado Op√ß√£o de alterar a Forma de Pagamento manualmente de cada produto do historico(em casos de
          confus√£o ou altera√ß√£o).<strong style="color: var(--principal);">(Painel de Controle)</strong></li>

        <li>6. Adicionado valor total de Estoque dos Produtos.<strong style="color: var(--principal);">(Painel de
            Controle)</strong></li>

      </ul>
    </div>

    <!-- [BETA] Vers√£o 1.0.1 -->
    <div class="changelog-entry">
      <h3>[BETA] Vers√£o 1.0.1 - Corre√ß√£o de Bug + Adi√ß√£o Formas de Pagamento</h3>
      <p class="changelog-date">12 de Abril de 2025</p>
      <p class="changelog-header">Corre√ß√µes:</p>
      <ul class="update-list">
        <li>1. Corrigido erro no gr√°fico de vendas, que mostrava as vendas com um dia de atraso.<strong
            style="color: var(--principal);">(Painel de Controle)</strong></li>
        <li>2. Ajustado a manipula√ß√£o de datas no hist√≥rico de vendas para evitar discrep√¢ncias.<strong
            style="color: var(--principal);">(Painel de Controle)</strong></li>
        <li>3. Agora os dados do gr√°fico de vendas, a fun√ß√£o a onde era exibido os <strong>DIA DA SEMANA/DIA DO M√äS/M√äS
            DO ANO</strong>, foi alterada para o formato <strong>DIA DA VENDA/M√äS/ANO</strong><strong
            style="color: var(--principal);">(Painel de Controle)</strong></li>
      </ul>
      <p class="changelog-date">12 de Abril de 2025</p>
      <p class="changelog-header">Novidades:</p>
      <ul class="update-list">
        <li>1. Adicionado op√ß√£o de selecionar a Forma de Pagamento na hora de registrar a venda do produto. tendo a
          possibilidade de escolher entre as seguintes op√ß√µes: Dinheiro, Pix, Cart√£o, Outro.<strong
            style="color: var(--principal);">(Registrar Venda)</strong></li>
        <li>2. Adicionado ao <strong>Painel de Controle</strong> a op√ß√£o de pagamento da venda do produto<strong
            style="color: var(--principal);">(Painel de Controle)</strong></li>
      </ul>
    </div>

    <!-- [BETA] Vers√£o 1.0.0 -->
    <div class="changelog-entry">
      <h3>[BETA] Vers√£o 1.0.0 - Lan√ßamento Inicial</h3>
      <p class="changelog-date">10 de Abril de 2025</p>
      <p class="changelog-header">Novidades:</p>
      <ul class="update-list">
        <li>1. Implementado sistema de cadastro de produtos e controle de estoque.<strong
            style="color: var(--principal);">(Sistema de Controle Use Stylo)</strong></li>
        <li>2. Desenvolvido m√≥dulo de vendas com registro de transa√ß√µes e hist√≥rico de vendas.<strong
            style="color: var(--principal);">(Sistema de Controle Use Stylo)</strong></li>
        <li>3. Adicionada funcionalidade de gr√°ficos para acompanhamento de vendas por per√≠odo.<strong
            style="color: var(--principal);">(Sistema de Controle Use Stylo)</strong></li>
        <li>3. Adicionada funcionalidade de importar e exportar os dados do navegador(venda,estoque, historico) para um
          banco de dados.<strong style="color: var(--principal);">(Sistema de Controle Use Stylo)</strong></li>
      </ul>
    </div>

  </div>
  <!--! FIM ATUALIZA√á√ïES DO SISTEMA -->

  <!--! FOOTER -->
  <div class="footer">
    <div class="footer1">
      <span>
        <strong>
          Copyright &#169; 2025
        </strong>
        <a href="http://www.linksite.com">
          <strong>

          </strong>
        </a>
        <strong>
          Todos os Direitos Reservados.
        </strong>
      </span>

      <span>
        <span style="color: var(--branco);">
          <strong>Powered By</strong>
        </span>

        <a href="https://github.com/freitasfzw/" target="_blank">
          <span style="color: var(--principal);">
            <strong>Freitas Fzw</strong>
          </span>
        </a>
      </span>


    </div>
  </div>

  <!--! FIM FOOTER -->

  <!--! PAINEL DE SENHA -->
  <div id="senhaModal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center;">
    <div
      style="background:var(--background2); padding:20px; border-radius:10px; text-align:center; width:90%; max-width:300px;">
      <h3>Senha Necess√°ria</h3>
      <input type="password" id="senhaInput" placeholder="Digite a senha"
        style="width:80%; padding:10px; margin:10px 0;">
      <button onclick="verificarSenha()">Entrar</button>
      <button onclick="fecharModalSenha()">Cancelar</button>
    </div>
  </div>
  <!--! FIM PAINEL DE SENHA -->

  <!--? SCRIPT -->
  <script>
    window.db
    window.ref
    window.set
    window.get
    window.child


    let estoque = JSON.parse(localStorage.getItem('estoque')) || [];
    let vendas = JSON.parse(localStorage.getItem('vendas')) || [];
    let carrinho = [];


    function carregarCrediarios() {
      const listaDiv = document.getElementById('listaCrediarios');
      const crediarios = JSON.parse(localStorage.getItem('crediarios')) || [];

      listaDiv.innerHTML = '<h2 style="justify-content: center; align-items: center; text-align: center">Clientes no Credi√°rio</h2>';

      crediarios.forEach((c, i) => {
        const valorParcela = (parseFloat(c.valorCompra) / c.parcelasTotais).toFixed(2);
        listaDiv.innerHTML += `
        <div style="border:1px solid #ccc; margin:10px 0; padding:10px;">
          <p><strong>Nome:</strong> ${c.nomeCliente}</p>
          <p><strong>CPF:</strong> ${c.cpfCliente}</p>
          <p><strong>Telefone:</strong> ${c.numCliente}</p>
          <p><strong>Produtos:</strong> ${c.produtosComprados}</p>
          <p><strong>Valor Total:</strong> R$ ${parseFloat(c.valorCompra).toFixed(2)}</p>
          <p><strong>Valor Parcela:</strong> R$ ${valorParcela}</p>
          <p><strong>Data da Compra:</strong> ${c.dataCompra}</p>
          <p><strong>Dia Pagamento:</strong> ${c.diaPagamento}</p>
          <p><strong>Parcelas:</strong> ${c.parcelasPagas} / ${c.parcelasTotais}</p>
          <button onclick="pagarParcela(${i})" ${c.parcelasPagas >= c.parcelasTotais ? 'disabled' : ''}>
            Pagar Parcela
          </button>
          <button onclick="removerCrediario(${i})">Remover Crediario</button>
          <button onclick="abrirWhatsApp('${c.numCliente}')">Alertar Vencimento no WhatsApp</button>
        </div>
      `;
      });

      carregarHistorico();
    }

    function abrirWhatsApp(numero) {
      const numeroLimpo = numero.replace(/\D/g, '');

      let numeroFinal = numeroLimpo;
      if (!numeroLimpo.startsWith('55')) {
        numeroFinal = '55' + numeroLimpo;
      }

      const url = `https://wa.me/${numeroFinal}?text=Oi!%20Tudo%20bem%3F%0AAqui%20%C3%A9%20da%20Use%20Stylo.%20Estamos%20passando%20para%20lembrar%20que%20a%20pr%C3%B3xima%20parcela%20do%20seu%20credi%C3%A1rio%20est%C3%A1%20chegando.%0A%0ASe%20precisar%20de%20qualquer%20informa%C3%A7%C3%A3o%20sobre%20o%20seu%20credi%C3%A1rio%2C%20%C3%A9%20s%C3%B3%20chamar.%20Estamos%20aqui%20para%20ajudar!%0A%0AAgradecemos%20pela%20confian%C3%A7a.%0AAtenciosamente%2C%0AUse%20Stylo%0A%0A(Mensagem%20automatizada)`;
      window.open(url, '_blank');
    }

    function adicionarCrediario() {
      const nomeCliente = document.getElementById('nomeCliente').value.trim();
      const cpfCliente = document.getElementById('cpfCliente').value.trim();
      const numCliente = document.getElementById('numCliente').value.trim();
      const produtosComprados = document.getElementById('produtosComprados').value.trim();
      const valorCompraRaw = document.getElementById('valorCompra').value.trim().replace(',', '.');
      const valorCompra = parseFloat(valorCompraRaw);
      const dataCompra = document.getElementById('dataCompra').value;
      const diaPagamento = parseInt(document.getElementById('diaPagamento').value);
      const parcelasTotais = parseInt(document.getElementById('parcelasTotais').value);

      console.log('Verificando campos...');
      if (!nomeCliente) { console.log('Campo nomeCliente vazio'); alert('Preencha o nome do cliente correto.'); return; }
      if (!cpfCliente) { console.log('Campo cpfCliente vazio'); alert('Preencha um CPF valido.'); return; }
      if (!numCliente) { console.log('Campo numCliente vazio'); alert('Preencha um Telefone valido.'); return; }
      if (!produtosComprados) { console.log('Campo produtosComprados vazio'); alert('Preencha os produtos comprados.'); return; }
      if (!valorCompraRaw) { console.log('Campo valorCompra vazio'); alert('Preencha o valor da compra correto.'); return; }
      if (isNaN(valorCompra) || valorCompra <= 0) { console.log('Valor da compra inv√°lido:', valorCompraRaw); alert('Valor da compra inv√°lido.'); return; }
      if (!dataCompra) { console.log('Campo dataCompra vazio'); alert('Preencha a data da compra correta.'); return; }
      if (isNaN(diaPagamento) || diaPagamento < 1 || diaPagamento > 31) { console.log('Dia do pagamento inv√°lido:', diaPagamento); alert('Preencha o dia do pagamento corretamente (1 a 31).'); return; }
      if (isNaN(parcelasTotais) || parcelasTotais < 1) { console.log('N√∫mero de parcelas inv√°lido:', parcelasTotais); alert('Preencha o n√∫mero de parcelas corretamente.'); return; }

      // Se passar todas as valida√ß√µes, salva o credi√°rio
      const crediarios = JSON.parse(localStorage.getItem('crediarios')) || [];

      crediarios.push({
        nomeCliente,
        cpfCliente,
        numCliente,
        produtosComprados,
        valorCompra,
        dataCompra,
        diaPagamento,
        parcelasTotais,
        parcelasPagas: 0
      });

      localStorage.setItem('crediarios', JSON.stringify(crediarios));
      limparFormulario();
      carregarCrediarios();
    }

    function limparFormulario() {
      document.getElementById('nomeCliente').value = '';
      document.getElementById('cpfCliente').value = '';
      document.getElementById('numCliente').value = '';
      document.getElementById('produtosComprados').value = '';
      document.getElementById('valorCompra').value = '';
      document.getElementById('dataCompra').value = '';
      document.getElementById('diaPagamento').value = '';
      document.getElementById('parcelasTotais').value = '';
    }

    function carregarHistorico() {
      const historicoDiv = document.getElementById('listaHistoricoCrediarios');
      const historico = JSON.parse(localStorage.getItem('historicoCrediariosPagos')) || [];

      historicoDiv.innerHTML = '<h2>Credi√°rios Pagos</h2>';

      if (historico.length === 0) {
        historicoDiv.innerHTML += '<p>Nenhum credi√°rio pago ainda.</p>';
        return;
      }

      historico.forEach((c, i) => {
        historicoDiv.innerHTML += `
      <div style="border:1px solid #ccc; margin:10px 0; padding:10px;">
        <p><strong>Nome:</strong> ${c.nomeCliente}</p>
        <p><strong>CPF:</strong> ${c.cpfCliente}</p>
        <p><strong>Telefone:</strong> ${c.numCliente}</p>
        <p><strong>Produtos:</strong> ${c.produtosComprados}</p>
        <p><strong>Valor Total:</strong> R$ ${parseFloat(c.valorCompra).toFixed(2)}</p>
        <p><strong>Data da Compra:</strong> ${c.dataCompra}</p>
        <p><strong>Data de Pagamento Final:</strong> ${c.dataPagamentoFinal || 'N√£o informado'}</p>
        <p><strong>Parcelas:</strong> ${c.parcelasPagas} / ${c.parcelasTotais}</p>
        <button onclick="removerDoHistorico(${i})">Remover</button>
      </div>
    `;
      });
    }

    function removerDoHistorico(index) {
      const historico = JSON.parse(localStorage.getItem('historicoCrediariosPagos')) || [];
      historico.splice(index, 1);
      localStorage.setItem('historicoCrediariosPagos', JSON.stringify(historico));
      carregarHistorico();
    }

    function pagarParcela(index) {
      const crediarios = JSON.parse(localStorage.getItem('crediarios')) || [];
      const historico = JSON.parse(localStorage.getItem('historicoCrediariosPagos')) || [];

      if (crediarios[index].parcelasPagas < crediarios[index].parcelasTotais) {
        crediarios[index].parcelasPagas++;

        // Se pagou todas as parcelas, move para hist√≥rico
        if (crediarios[index].parcelasPagas >= crediarios[index].parcelasTotais) {
          // Adiciona data de pagamento final (opcional)
          crediarios[index].dataPagamentoFinal = new Date().toLocaleDateString();

          historico.push(crediarios[index]);
          crediarios.splice(index, 1);
        }

        localStorage.setItem('crediarios', JSON.stringify(crediarios));
        localStorage.setItem('historicoCrediariosPagos', JSON.stringify(historico));
        carregarCrediarios();
        carregarHistorico(); // Se voc√™ criar uma fun√ß√£o para mostrar hist√≥rico
      }
    }

    document.getElementById('btnSalvarCrediario').addEventListener('click', function (event) {
      event.preventDefault(); // evita recarregar a p√°gina
      adicionarCrediario();
    });

    carregarCrediarios();

    function removerCrediario(index) {
      const crediarios = JSON.parse(localStorage.getItem('crediarios')) || [];
      crediarios.splice(index, 1);
      localStorage.setItem('crediarios', JSON.stringify(crediarios));
      carregarCrediarios();
    }

    function calcularTroco() {
      const valorCompra = parseFloat(document.getElementById("valorCompra").value);
      const valorPago = parseFloat(document.getElementById("valorPago").value);
      const resultadoDiv = document.getElementById("resultado");

      if (isNaN(valorCompra) || isNaN(valorPago)) {
        resultadoDiv.innerHTML = "<p>Preencha ambos os campos.</p>";
        return;
      }

      if (valorPago < valorCompra) {
        resultadoDiv.innerHTML = "<p>Valor pago insuficiente.</p>";
        return;
      }

      let troco = (valorPago - valorCompra).toFixed(2);
      let trocoRestante = troco;

      const cedulas = [200, 100, 50, 20, 10, 5, 2];
      const moedas = [1, 0.5, 0.25, 0.1, 0.05, 0.01];

      let detalhes = "<h3>Troco: R$ " + troco + "</h3><ul>";

      cedulas.forEach((valor) => {
        const qtd = Math.floor(trocoRestante / valor);
        if (qtd > 0) {
          detalhes += `<li>${qtd} x R$ ${valor.toFixed(2)}</li>`;
          trocoRestante -= qtd * valor;
          trocoRestante = trocoRestante.toFixed(2);
        }
      });

      moedas.forEach((valor) => {
        const qtd = Math.floor(trocoRestante / valor);
        if (qtd > 0) {
          detalhes += `<li>${qtd} x R$ ${valor.toFixed(2)}</li>`;
          trocoRestante -= qtd * valor;
          trocoRestante = trocoRestante.toFixed(2);
        }
      });

      detalhes += "</ul>";

      resultadoDiv.innerHTML = detalhes;
    }

    function salvarDados() {
      localStorage.setItem('estoque', JSON.stringify(estoque));
      localStorage.setItem('vendas', JSON.stringify(vendas));
    }

    function fecharAviso() {
      document.getElementById('avisoModal').style.display = 'none';
    }

    function verificarSenha() {
      const senhaCorreta = '1234'; // voc√™ pode trocar essa senha aqui
      const input = document.getElementById('senhaInput');
      const senhaDigitada = input.value;
      const aba = input.getAttribute('data-target');

      if (senhaDigitada === senhaCorreta) {
        fecharModalSenha();
        abrirAba(aba);
      } else {
        alert('Senha incorreta!');
        input.value = '';
      }
    }

    function fecharModalSenha() {
      document.getElementById('senhaModal').style.display = 'none';
      document.getElementById('senhaInput').value = '';
    }

    function mostrarAba(abaId) {
      if (abaId === 'historico') {
        document.getElementById('senhaModal').style.display = 'flex';
        document.getElementById('senhaInput').setAttribute('data-target', abaId);
        return;
      }

      abrirAba(abaId);
    }

    function abrirAba(abaId) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(abaId).classList.add('active');
      if (abaId === 'estoque') atualizarTabelaEstoque();
      if (abaId === 'vendas') atualizarSelectProdutos();
      if (abaId === 'historico') atualizarHistorico();
    }

    function adicionarProduto() {
      const nome = document.getElementById('nomeProduto').value;
      const quantidade = parseInt(document.getElementById('quantidadeProduto').value);
      const preco = parseFloat(document.getElementById('precoProduto').value);
      if (!nome || isNaN(quantidade) || isNaN(preco)) return alert('Preencha todos os campos corretamente.');
      const existente = estoque.find(p => p.nome === nome);
      if (existente) {
        existente.quantidade += quantidade;
        existente.preco = preco;
      } else {
        estoque.push({ nome, quantidade, preco });
      }
      salvarDados();
      atualizarTabelaEstoque();
    }

    function editarProduto(index) {
      const novoNome = prompt('Novo nome:', estoque[index].nome);
      const novaQuantidade = parseInt(prompt('Nova quantidade:', estoque[index].quantidade));
      const novoPreco = parseFloat(prompt('Novo pre√ßo:', estoque[index].preco));
      if (!novoNome || isNaN(novaQuantidade) || isNaN(novoPreco)) return;
      estoque[index] = { nome: novoNome, quantidade: novaQuantidade, preco: novoPreco };
      salvarDados();
      atualizarTabelaEstoque();
    }

    function excluirProduto(index) {
      if (confirm('Tem certeza que deseja excluir este produto?')) {
        estoque.splice(index, 1);
        salvarDados();
        atualizarTabelaEstoque();
      }
    }

    function atualizarTabelaEstoque() {
      const tabela = document.getElementById('tabelaEstoque');
      tabela.innerHTML = '<tr><th>Produto</th><th>Quantidade</th><th>Pre√ßo (R$)</th><th>A√ß√µes</th></tr>';

      let valorTotal = 0;

      estoque.forEach((p, i) => {
        const valorProduto = p.quantidade * p.preco;
        valorTotal += valorProduto;

        tabela.innerHTML += `
  <tr>
    <td>${p.nome}</td>
    <td>${p.quantidade}</td>
    <td>${p.preco.toFixed(2)}</td>
    <td>
      <button onclick="editarProduto(${i})">Editar</button>
      <button onclick="excluirProduto(${i})">Excluir</button>
    </td>
  </tr>`;
      });

      // Atualiza o valor total no par√°grafo abaixo da tabela
      document.getElementById('valorTotalEstoque').innerText = `Valor Total em Estoque: R$ ${valorTotal.toFixed(2)}`;
    }

    function atualizarSelectProdutos() {
      const select = document.getElementById('produtoVenda');
      select.innerHTML = '';
      estoque.forEach((p, i) => {
        if (p.quantidade > 0)
          select.innerHTML += `<option value="${i}">${p.nome} - R$${p.preco.toFixed(2)}</option>`;
      });
    }

    function adicionarAoCarrinho() {
      const index = document.getElementById('produtoVenda').value;
      const quantidade = parseInt(document.getElementById('quantidadeVenda').value);
      const desconto = parseFloat(document.getElementById('descontoVenda').value) || 0;
      const cliente = document.getElementById('clienteVenda').value.trim() || "Cliente N√£o Informado";

      if (index === '' || isNaN(quantidade)) {
        return alert('Preencha corretamente todos os campos.');
      }

      const produto = estoque[index];
      if (quantidade > produto.quantidade) {
        return alert('Quantidade insuficiente no estoque.');
      }

      const precoComDesconto = produto.preco - (produto.preco * desconto / 100);
      const subtotal = precoComDesconto * quantidade;

      carrinho.push({
        idProduto: index,
        nome: produto.nome,
        quantidade,
        preco: produto.preco,
        desconto,
        precoComDesconto,
        subtotal,
        cliente
      });

      atualizarCarrinhoUI();
    }

    function atualizarHistorico() {
      const vendas = JSON.parse(localStorage.getItem('vendas')) || [];

      const tabela = document.getElementById('tabelaVendas');
      const totalSpan = document.getElementById('totalVendido');
      const totalPorFormaSpan = document.getElementById('totaisPorForma');

      tabela.innerHTML = `
<tr>
  <th>Data</th>
  <th>Produto</th>
  <th>Qtd</th>
  <th>Pre√ßo (R$)</th>
  <th>Desconto (%)</th>
  <th>Com Desconto (R$)</th>
  <th>Total</th>
  <th>Forma de Pagamento</th>
  <th>A√ß√µes</th>
</tr>
`;

      let total = 0;
      let totaisPorForma = {};

      vendas.forEach((v, i) => {
        const precoComDesconto = v.precoComDesconto || v.preco;
        const subtotal = v.quantidade * precoComDesconto;
        total += subtotal;

        const forma = v.formaPagamento || 'N√£o informado';
        if (!totaisPorForma[forma]) totaisPorForma[forma] = 0;
        totaisPorForma[forma] += subtotal;

        tabela.innerHTML += `
  <tr>
<td>
  <input type="date" value="${v.data}" onchange="editarDataVenda(${i}, this.value)">
  <br><small>${v.hora || ''}</small>
</td>
    <td>${v.nome}</td>
    <td>${v.quantidade}</td>
    <td>${v.preco.toFixed(2)}</td>
    <td>${v.desconto ? v.desconto + '%' : '0%'}</td>
    <td>${precoComDesconto.toFixed(2)}</td>
    <td>${subtotal.toFixed(2)}</td>
    <td>
      <select onchange="editarFormaPagamento(${i}, this.value)">
        <option value="">Selecionar</option>
        <option value="Dinheiro" ${v.formaPagamento === 'Dinheiro' ? 'selected' : ''}>Dinheiro</option>
        <option value="Pix" ${v.formaPagamento === 'Pix' ? 'selected' : ''}>Pix</option>
        <option value="Cartao-Debito" ${v.formaPagamento === 'Cartao-Debito' ? 'selected' : ''}>Cart√£o D√©bito</option>
        <option value="Cartao-Credito" ${v.formaPagamento === 'Cartao-Credito' ? 'selected' : ''}>Cart√£o Cr√©dito</option>
        <option value="Crediario" ${v.formaPagamento === 'Crediario' ? 'selected' : ''}>Credi√°rio</option>
      </select>
    </td>
    <td>
      <button onclick="removerVenda(${i})">Remover</button><br>
      <button onclick="gerarComprovanteDaVenda(${i})">Comprovante</button>
    </td>
  </tr>
`;
      });

      totalSpan.textContent = total.toFixed(2);

      let htmlTotais = '<h3>Total por Forma de Pagamento:</h3><ul>';
      for (let forma in totaisPorForma) {
        htmlTotais += `<li>${forma}: R$ ${totaisPorForma[forma].toFixed(2)}</li>`;
      }
      htmlTotais += '</ul>';
      totalPorFormaSpan.innerHTML = htmlTotais;

      atualizarGrafico('semana');
    }

    function atualizarCarrinhoUI() {
      const container = document.getElementById('carrinhoContainer');
      container.innerHTML = '';
      let total = 0;

      carrinho.forEach((item, index) => {
        total += item.subtotal;

        container.innerHTML += `
      <div>
        ${item.nome} - ${item.quantidade}x R$${item.preco.toFixed(2)} 
        (${item.desconto}% desc) = R$${item.subtotal.toFixed(2)}
        <button onclick="removerDoCarrinho(${index})">Remover</button>
      </div>
    `;
      });

      container.innerHTML += `<strong>Total: R$${total.toFixed(2)}</strong>`;
    }

    function removerDoCarrinho(index) {
      carrinho.splice(index, 1);
      atualizarCarrinhoUI();
    }

    function finalizarVenda() {
      if (carrinho.length === 0) {
        return alert("Carrinho est√° vazio.");
      }

      const formaPagamento = document.getElementById('formaPagamento').value;
      if (!formaPagamento) {
        return alert("Selecione a forma de pagamento.");
      }

      const hoje = new Date();
      const data = hoje.toISOString().split('T')[0];
      const hora = hoje.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

      carrinho.forEach(item => {
        estoque[item.idProduto].quantidade -= item.quantidade;

        vendas.push({
          nome: item.nome,
          quantidade: item.quantidade,
          preco: item.preco,
          desconto: item.desconto,
          precoComDesconto: item.precoComDesconto,
          formaPagamento,
          data,
          hora,
          cliente: item.cliente
        });
      });

      salvarDados();
      atualizarHistorico();
      carrinho = [];
      atualizarCarrinhoUI();
      alert("Venda finalizada com sucesso!");
      atualizarSelectProdutos();
    }

    function gerarComprovanteDaVenda(index) {
      const vendas = JSON.parse(localStorage.getItem('vendas')) || [];
      const venda = vendas[index];
      gerarComprovante(venda);
    }

    function gerarComprovante(venda) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const precoComDesconto = venda.precoComDesconto !== undefined ? venda.precoComDesconto : venda.preco;
      const totalPago = venda.quantidade * precoComDesconto;

      // Configura√ß√µes b√°sicas
      doc.setFontSize(10);
      doc.setTextColor(0, 0, 0);
      let y = 10;

      // Cabe√ßalho
      doc.setFontSize(14);
      doc.setTextColor(123, 44, 191);
      doc.text("USE STYLO", 105, y, { align: "center" });
      y += 5;
      doc.setFontSize(10);
      doc.setTextColor(0, 0, 0);
      doc.text("CNPJ: 00.000.000/0001-00", 105, y, { align: "center" });
      y += 5;
      doc.text("Endere√ßo: Rua 7 de Setembro, 478 - Centro, S√£o Pedro do Sul, Rio Grande do Sul, Brazil, 97400000", 105, y, { align: "center" });
      y += 5;
      doc.text("Telefone: (55) 99206-1704", 105, y, { align: "center" });
      y += 10;

      // Linha divis√≥ria
      doc.line(10, y, 200, y);
      y += 5;

      // Informa√ß√µes da venda
      doc.text(`Data da emiss√£o: ${venda.data || 'N/A'}`, 10, y);
      doc.text(`Hora da emiss√£o: ${venda.hora || 'N/A'}`, 150, y);
      y += 7;
      if (venda.cliente) {
        doc.text(`Nome Completo: ${venda.cliente}`, 10, y);
        y += 7;
      }

      doc.line(10, y, 200, y);
      y += 5;

      // Produto
      doc.text(`Produto: ${venda.nome || 'N/A'}`, 10, y);
      y += 7;
      doc.text(`Quantidade: ${venda.quantidade || '0'}`, 10, y);
      y += 7;
      doc.text(`Pre√ßo Unit√°rio: R$ ${venda.preco?.toFixed(2) || '0.00'}`, 10, y);
      y += 7;
      doc.text(`Desconto: ${venda.desconto !== undefined ? venda.desconto + '%' : '0%'}`, 10, y);
      y += 7;
      doc.text(`Pre√ßo Final Unit√°rio: R$ ${precoComDesconto.toFixed(2)}`, 10, y);
      y += 7;

      doc.line(10, y, 200, y);
      y += 5;

      // Pagamento
      doc.text(`Forma de Pagamento: ${venda.formaPagamento || 'N√£o informado'}`, 10, y);
      y += 7;
      doc.text(`Total Pago: R$ ${totalPago.toFixed(2)}`, 10, y);
      y += 10;

      // Agradecimento
      doc.setFontSize(10);
      doc.setTextColor(123, 44, 191);
      doc.text("Obrigado pela prefer√™ncia!", 105, y, { align: "center" });
      y += 5;
      doc.text("- Use o seu Stylo -", 105, y, { align: "center" });

      // Salvar PDF
      doc.save(`Comprovante_${venda.nome || 'Venda'}_${venda.data || 'data'}.pdf`);
    }

    function editarFormaPagamento(index, novaForma) {
      vendas[index].formaPagamento = novaForma;
      salvarDados();
      atualizarHistorico();
    }

    function editarDataVenda(index, novaData) {
      vendas[index].data = novaData;
      salvarDados();
      atualizarHistorico();
    }

    function removerVenda(index) {
      if (confirm("Tem certeza que deseja remover esta venda do hist√≥rico?")) {
        vendas.splice(index, 1);
        salvarDados();
        atualizarHistorico();
      }
    }

    function filtrarVendas() {
      const dataFiltro = document.getElementById('filtroData').value;
      const tabela = document.getElementById('tabelaVendas');
      const totalSpan = document.getElementById('totalVendido');
      const totalPorFormaSpan = document.getElementById('totaisPorForma');

      tabela.innerHTML = `
<tr>
  <th>Data</th>
  <th>Produto</th>
  <th>Qtd</th>
  <th>Pre√ßo (R$)</th>
  <th>Desconto (%)</th>
  <th>Com Desconto (R$)</th>
  <th>Total</th>
  <th>Forma de Pagamento</th>
  <th>A√ß√µes</th>
</tr>
`;

      let total = 0;
      let totaisPorForma = {};

      vendas.filter(v => !dataFiltro || v.data === dataFiltro).forEach((v, i) => {
        const precoComDesconto = v.precoComDesconto || v.preco;
        const subtotal = v.quantidade * precoComDesconto;
        total += subtotal;

        // Acumular valor conforme forma de pagamento
        const forma = v.formaPagamento || 'N√£o informado';
        if (!totaisPorForma[forma]) totaisPorForma[forma] = 0;
        totaisPorForma[forma] += subtotal;

        tabela.innerHTML += `
  <tr>
    <td>${v.data}</td>
    <td>${v.nome}</td>
    <td>${v.quantidade}</td>
    <td>${v.preco.toFixed(2)}</td>
    <td>${v.desconto ? v.desconto + '%' : '0%'}</td>
    <td>${precoComDesconto.toFixed(2)}</td>
    <td>${subtotal.toFixed(2)}</td>
    <td>
      <select onchange="editarFormaPagamento(${i}, this.value)">
        <option value="">Selecionar</option>
        <option value="Dinheiro" ${v.formaPagamento === 'Dinheiro' ? 'selected' : ''}>Dinheiro</option>
        <option value="Pix" ${v.formaPagamento === 'Pix' ? 'selected' : ''}>Pix</option>
        <option value="Cartao-Debito" ${v.formaPagamento === 'Cartao-Debito' ? 'selected' : ''}>Cart√£o D√©bito</option>
        <option value="Cartao-Credito" ${v.formaPagamento === 'Cartao-Credito' ? 'selected' : ''}>Cart√£o Cr√©dito</option>
        <option value="Crediario" ${v.formaPagamento === 'Crediario' ? 'selected' : ''}>Credi√°rio</option>
      </select>
    </td>
    <td><button onclick="removerVenda(${i})">Remover</button></td>
  </tr>
`;
      });

      totalSpan.textContent = total.toFixed(2);

      // Exibir os totais por forma de pagamento
      let htmlTotais = '<h3>Total por Forma de Pagamento:</h3><ul>';
      for (let forma in totaisPorForma) {
        htmlTotais += `<li>${forma}: R$ ${totaisPorForma[forma].toFixed(2)}</li>`;
      }

      totalPorFormaSpan.innerHTML = htmlTotais;
    }

    function removerFiltro() {
      document.getElementById('filtroData').value = '';  // Limpa o campo de data
      atualizarHistorico();  // Recarrega o hist√≥rico completo
    }

    function gerarRelatorioMensal() {
      const mesAtual = new Date().toISOString().slice(0, 7);
      document.getElementById('filtroData').value = '';
      const tabela = document.getElementById('tabelaVendas');
      tabela.innerHTML = '<tr><th>Data</th><th>Produto</th><th>Qtd</th><th>Pre√ßo (R$)</th><th>Total</th></tr>';
      let total = 0;
      vendas.filter(v => v.data.startsWith(mesAtual)).forEach(v => {
        const subtotal = v.quantidade * v.preco;
        total += subtotal;
        tabela.innerHTML += `<tr><td>${v.data}</td><td>${v.nome}</td><td>${v.quantidade}</td><td>${v.preco.toFixed(2)}</td><td>${subtotal.toFixed(2)}</td></tr>`;
      });
      document.getElementById('totalVendido').textContent = total.toFixed(2);
    }

    function exportarBackup() {
      const dados = {
        estoque: estoque,
        vendas: vendas,
      };

      const dadosJSON = JSON.stringify(dados);  // Convertendo os dados para JSON
      const blob = new Blob([dadosJSON], { type: 'application/json' });  // Criando o arquivo JSON
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'backup_vendas.json';  // Nome do arquivo de backup
      a.click();
    }

    function importarBackup() {
      document.getElementById('arquivoBackup').click();
    }

    function carregarBackup(event) {
      const file = event.target.files[0];  // Pegando o arquivo selecionado
      if (!file) return;

      const reader = new FileReader();  // Criando um objeto para ler o arquivo
      reader.onload = function (e) {
        try {
          const conteudo = JSON.parse(e.target.result);  // Parseando o conte√∫do do arquivo JSON

          // Garantir que os dados sejam restaurados
          estoque = conteudo.estoque || [];
          vendas = conteudo.vendas || [];

          salvarDados();  // Fun√ß√£o para salvar os dados restaurados
          alert('Backup importado com sucesso!');
          mostrarAba('estoque');  // Mostrando a aba de estoque ap√≥s o import
        } catch (error) {
          alert('Erro ao carregar o backup. Certifique-se de que o arquivo est√° correto.');
        }
      };

      reader.readAsText(file);  // Lendo o conte√∫do do arquivo como texto
    }

    function atualizarGrafico(tipo) {
      // Recarrega os dados de vendas do localStorage
      const vendas = JSON.parse(localStorage.getItem('vendas')) || []; // Garantir que estamos usando os dados mais recentes

      const ctx = document.getElementById('graficoVendas').getContext('2d');
      let labels = [];
      let dados = [];

      // Reset dados
      let mapa = {};

      vendas.forEach(v => {
        const data = new Date(v.data);  // Garantimos que estamos lidando com um objeto Date corretamente
        let chave;

        // Calcular o valor da venda com desconto, se dispon√≠vel
        const precoComDesconto = v.precoComDesconto || v.preco;  // Considera o desconto se estiver presente
        const subtotal = v.quantidade * precoComDesconto;  // Calcular o total considerando o desconto

        if (tipo === 'semana') {
          chave = data.toISOString().split('T')[0]; // Garantir que usamos o formato ISO para a data
        } else if (tipo === 'mes') {
          chave = data.toISOString().slice(0, 7);  // Ano e m√™s, por exemplo: '2025-04'
        } else if (tipo === 'ano') {
          chave = data.getFullYear();  // Apenas o ano
        }

        if (!mapa[chave]) mapa[chave] = 0;
        mapa[chave] += subtotal;  // Usa o valor com desconto

      });

      labels = Object.keys(mapa);
      dados = Object.values(mapa);

      // Ordena as chaves cronologicamente se for m√™s ou ano
      if (tipo === 'mes') {
        labels.sort((a, b) => parseInt(a) - parseInt(b));
        dados = labels.map(dia => mapa[dia]);
      } else if (tipo === 'ano') {
        const ordemMeses = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
        labels.sort((a, b) => ordemMeses.indexOf(a) - ordemMeses.indexOf(b));
        dados = labels.map(mes => mapa[mes]);
      }

      // Destroi gr√°fico anterior se j√° existir
      if (window.graficoVendasObj) {
        window.graficoVendasObj.destroy();
      }

      // Cria o novo gr√°fico
      window.graficoVendasObj = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Total Vendido (R$)',
            data: dados,
            backgroundColor: 'rgba(162, 0, 255, 1)',
            borderColor: 'rgba(155, 89, 182, 1)',
            borderWidth: 1,
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    mostrarAba('estoque');

    function relatorioPorCategoria() {
      const categorias = {};
      vendas.forEach(v => {
        const produto = estoque.find(p => p.nome === v.nome);
        const cat = produto?.categoria || "Sem categoria";
        const subtotal = v.quantidade * v.preco;
        categorias[cat] = (categorias[cat] || 0) + subtotal;
      });
      let texto = "Relat√≥rio por Categoria:\n";
      for (let cat in categorias) {
        texto += `‚Ä¢ ${cat}: R$ ${categorias[cat].toFixed(2)}\n`;
      }
      alert(texto);
    }

    function relatorioPorDiaSemana() {
      const dias = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
      const totais = Array(7).fill(0);
      vendas.forEach(v => {
        const dia = new Date(v.data).getDay();
        totais[dia] += v.quantidade * v.preco;
      });
      let texto = "Relat√≥rio por Dia da Semana:\n";
      totais.forEach((total, i) => {
        texto += `‚Ä¢ ${dias[i]}: R$ ${total.toFixed(2)}\n`;
      });
      alert(texto);
    }

    function relatorioTicketMedio() {
      if (vendas.length === 0) return alert("Nenhuma venda registrada.");
      const totalVendido = vendas.reduce((acc, v) => acc + v.quantidade * v.preco, 0);
      const ticketMedio = totalVendido / vendas.length;
      alert(`M√©dia de Vendas: R$ ${ticketMedio.toFixed(2)}`);
    }

  </script>
  <!--? FIM SCRIPT -->
</body>

</html>